services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - PIP_INDEX_URL=${PIP_INDEX_URL:-https://pypi.org/simple}
    container_name: competition-web
    ports:
      - "5000:5000"
    volumes:
      - ./assets/cert/stamps:/app/assets/cert/stamps
      - ./assets/cert/测试盖章.png:/app/assets/cert/测试盖章.png
      - ./assets/cert/test.png:/app/assets/cert/test.png
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SECRET_KEY=${SECRET_KEY}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
      - OLD_ENCRYPTION_KEYS=${OLD_ENCRYPTION_KEYS}
      - WX_APPID=${WX_APPID}
      - WX_SECRET=${WX_SECRET}
      - GUNICORN_WORKERS=${GUNICORN_WORKERS}
    restart: unless-stopped
    networks:
      - backend

networks:
  backend:
    external: true
    name: ${DOCKER_NETWORK}
